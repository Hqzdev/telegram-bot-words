# Telegram Bot для опроса собственников земельных участков

Этот бот предназначен для проведения опроса собственников земельных участков и сбора результатов в Google Sheets.

## Функциональность

- Проведение структурированного опроса с различными типами вопросов
- Поддержка текстовых ответов, одиночного и множественного выбора
- Запрос дополнительных комментариев где необходимо
- Автоматическое сохранение результатов в Google Sheets
- Удобный интерфейс с inline-клавиатурами

## Структура проекта

```
telegram-bott/
├── main.py                 # Главный файл запуска
├── bot/                    # Пакет с модулями бота
│   ├── __init__.py
│   ├── config.py           # Конфигурация
│   ├── bot_instance.py     # Экземпляр бота
│   ├── survey_manager.py   # Управление опросом
│   ├── keyboard_builder.py # Построение клавиатур
│   ├── data_processor.py   # Обработка данных
│   ├── google_sheets.py    # Работа с Google Sheets
│   └── handlers.py         # Обработчики команд
├── survey_config.json      # Конфигурация опроса
├── requirements.txt        # Зависимости
├── env_example.txt         # Пример переменных окружения
└── README.md              # Документация
```

## Установка и настройка

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Создание Telegram бота

1. Найдите @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен

### 3. Настройка Google Sheets

1. Создайте новую таблицу в Google Sheets
2. Скопируйте ID таблицы из URL (часть между /d/ и /edit)
3. Создайте Service Account в Google Cloud Console:
   - Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
   - Создайте новый проект или выберите существующий
   - Включите Google Sheets API
   - Создайте Service Account
   - Скачайте JSON файл с учетными данными
4. Предоставьте доступ к таблице для email из Service Account

### 4. Настройка переменных окружения

1. Скопируйте `env_example.txt` в `.env`
2. Заполните переменные:

```env
# Telegram Bot Token (получить у @BotFather)
TELEGRAM_TOKEN=your_telegram_bot_token_here

# Google Sheets ID (ID таблицы из URL)
GOOGLE_SHEETS_ID=your_google_sheets_id_here

# Путь к файлу с учетными данными Google Service Account
GOOGLE_CREDENTIALS_FILE=credentials.json
```

3. Поместите файл `credentials.json` в корневую папку проекта

### 5. Настройка описания бота

Через @BotFather настройте описание бота:
- `/setdescription` - установить описание
- `/setabouttext` - установить информацию о боте

## Запуск

```bash
python main.py
```

## Использование

1. Пользователь отправляет `/start`
2. Бот показывает приветственное сообщение с кнопкой "Перейти к вопросам"
3. Пользователь проходит все вопросы анкеты
4. Ответы автоматически сохраняются в Google Sheets
5. После завершения показывается сообщение об успешной отправке

## Структура данных в Google Sheets

Таблица содержит две колонки:
- **Вопросы** - точный текст вопроса из анкеты
- **Ответы** - соответствующий ответ пользователя

После каждой завершенной анкеты добавляется пустая строка для визуального разделения.

## Типы вопросов

### Текстовые вопросы
- Пользователь вводит текст вручную
- Пример: ФИО, площадь участка, контактные данные

### Одиночный выбор
- Пользователь выбирает один вариант из списка
- Может потребоваться дополнительный комментарий
- Пример: "Есть ли на участке постройки?"

### Множественный выбор
- Пользователь может выбрать несколько вариантов
- Переключаемые кнопки (вкл/выкл)
- Кнопка "Готово" для перехода дальше
- Пример: "Какие проблемы мешают эффективному использованию участка?"

## Логика комментариев

- **Обязательные комментарии**: запрашиваются автоматически при выборе опции
- **Необязательные комментарии**: пользователю предлагается оставить комментарий по желанию
- **Пропуск комментария**: доступен для необязательных комментариев

## Обработка ошибок

- Логирование всех операций
- Обработка ошибок подключения к Google Sheets
- Восстановление состояния при сбоях
- Возможность перезапуска опроса

## Безопасность

- Токены хранятся в переменных окружения
- Учетные данные Google Service Account в отдельном файле
- Валидация всех пользовательских вводов
- Очистка состояния пользователя после завершения

## Поддержка

При возникновении проблем:
1. Проверьте логи в консоли
2. Убедитесь в правильности настройки переменных окружения
3. Проверьте доступ к Google Sheets
4. Убедитесь в корректности файла `credentials.json`





